# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the **Dahlia Application Generator** - a testing/development tool that generates housing applications for the Dahlia housing portal (San Francisco's affordable housing application system). Built with Vite for modern development workflow with hot module replacement and optimized builds.

## Architecture

### Frontend Application (Vite + Vanilla JS)
- **Build Tool**: Vite for development server and bundling
- **Entry Point**: `index.html` → `src/main.js`
- **Styling**: `src/style.css` (imported in main.js)
- **Dependencies**: `@faker-js/faker` for generating realistic test data

### Application Logic (`src/main.js`)
The application generator:
- Uses ES modules with proper imports for faker.js
- Fetches preferences for a listing using `/api/v1/listings/{listingId}/preferences`
- Generates unique test applications with:
  - Random first/last names via faker.js
  - Unique session IDs (UUID format)
  - Timestamped email addresses (`dahlia.internal+{timestamp}@gmail.com`)
  - ISO timestamp as middle name for uniqueness tracking
  - Fixed test applicant data (DOB, address at 1 S VAN NESS AVE)
- Maps San Francisco housing preferences to their developer names:
  - Certificate of Preference (COP, V-COP)
  - Displaced Tenant Housing Preference (DTHP, V-DTHP)
  - Neighborhood Resident Housing Preference (NRHP, V-NRHP)
  - Live or Work in San Francisco (L_W, V-L_W)
- Submits applications via POST to `/api/v1/short-form/application`
- Batches submissions with 500ms delay between each to avoid overwhelming the server

### Vite Configuration (`vite.config.js`)
- **Dev Server**: Runs on port 3000 by default with automatic fallback if port is in use (`strictPort: false`)
- **Proxy**: All `/api/*` requests are proxied to `https://dahlia-full.herokuapp.com`
  - `changeOrigin: true` for proper host headers
  - `secure: true` for HTTPS validation
- This eliminates the need for a separate proxy server (though `server.js` still exists for standalone use)

## Running the Application

**Development mode (recommended):**
```bash
npm run dev
```
This starts the Vite dev server with HMR on port 3000 (or next available port). The API proxy is automatically configured.

**Other commands:**
- `npm run build` - Build for production (outputs to `dist/`)
- `npm run preview` - Preview production build locally
- `npm run server` - Run standalone proxy server (legacy, not needed with Vite)

## Development Workflow

1. Start the dev server: `npm run dev`
2. Open the URL shown in terminal (typically `http://localhost:3000`)
3. Make code changes - Vite will hot-reload automatically
4. Configure the application:
   - **Listing ID**: Enter a Dahlia listing ID (e.g., `a0Wbb000001JZxZEAW`)
   - **Number of Applications**: How many test applications to generate

## Key Technical Details

### Application Payload Structure
Applications submitted to Dahlia require:
- `externalSessionId`: Combination of two UUIDs (format: `{uuid1}-{uuid2}`)
- `applicationSubmittedDate`: Current date in YYYY-MM-DD format
- `primaryApplicant`: Object with contact info, address, and preference matching data
- `shortFormPreferences`: Array of preference objects with `listingPreferenceID` and `recordTypeDevName`
- `formMetadata`: JSON string containing completed sections and session info
- GIS coordinates for address validation (`xCoordinate`, `yCoordinate`, `candidateScore`)

### Preference Handling
- Live/Work preferences require additional fields: `individualPreference: "Live in SF"` and `optOut: true`
- Each preference has a `listingPreferenceID` (unique per listing) and `recordTypeDevName` (preference type code)
- The mapping in `PREFERENCE_NAME_MAP` converts human-readable preference names to developer codes

### Test Data Generation
All applications use:
- **Name**: Random first/last names generated by faker.js, with ISO timestamp as middle name for uniqueness
- **Email**: `dahlia.internal+{timestamp}@gmail.com` (unique per application)
- **DOB**: 1990-01-01 (fixed)
- **Address**: 1 S VAN NESS AVE APT A, San Francisco, CA 94103-1267 (fixed)
- **Income**: $4,000 monthly (fixed)
- **Phone**: No phone number (noPhone: true)

## Project Structure

```
applibot/
├── src/
│   ├── main.js      # Main application logic with ES modules
│   └── style.css    # Application styles
├── index.html       # Entry HTML file
├── vite.config.js   # Vite configuration with proxy setup
├── package.json     # Dependencies and scripts
├── server.js        # Legacy standalone proxy (not needed with Vite)
├── app.js           # Legacy app file (replaced by src/main.js)
├── styles.css       # Legacy styles (replaced by src/style.css)
├── test.js          # Raw fetch requests from browser DevTools
└── test.json        # HAR file with recorded network traffic
```

## Auxiliary Files

- `test.js`: Contains raw fetch requests copied from browser DevTools (network traffic capture)
- `test.json`: HAR (HTTP Archive) file with recorded network traffic for debugging/reference
- `server.js`, `app.js`, `styles.css`: Legacy files kept for reference but not used in Vite setup
